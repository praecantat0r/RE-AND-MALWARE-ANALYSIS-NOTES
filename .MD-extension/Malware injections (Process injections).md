# `Process injections`
## `PE injection - Write process memory`
-  Alocates a region of memory in a running process and writes an executable to the region mapping each section as it is written.
-   Noisy and easily detectable to AVs
-   Locate by putting a breakpoing at WriteProcessMemory and if you get to that call you can assume its writing some form of code into another process
-   Very common technique

> Breakpoints:
>  VirtualAlloc\
>  VirtualProtect\
>  CreateProcessInternalW\
>  WriteProcessMemory\
>  IsDebuggerPresent\
>  VirtualAllocEx

![](https://miro.medium.com/max/1400/0*bEyRx9exBN4D-kgy.png)

## `Example of this process`:

![](https://miro.medium.com/max/433/0*fzCB4s_90kbwq-HH.png)

## `PE Injection - NtMapViewOfSection`:
> Creates a section in a running process and maps an executable file into the created section
> Quiet and harder to detect by AVs
> Section = -   Section is a memory block that is shared between processes and can be created with `NtCreateSection` API (More knowledge on NtMapViewOfSections - https://www.ired.team/offensive-security/code-injection-process-injection/ntcreatesection-+-ntmapviewofsection-code-injection)

## `PE Injection - Process Doppelgänging`:
- Works on all versions of Windows including Windows 10
- it was difficult to detect by many AV products when it first appeared.
- Process Doppelgänging, writes the malicious code on the image before the process starts.
> 
![](https://miro.medium.com/max/471/0*JAO2zkchQN7YiQcP.png)

## `Process Doppelgänging Implementation`
-  **Transact** — Create a TxF transaction using a legitimate executable then overwrite the file with malicious code. These changes will be isolated and only visible within the context of the transaction.
-  **Load** — Create a shared section of memory and load the malicious executable.
-  **Rollback** — Undo changes to original executable, effectively removing malicious code from the file system.
-  **Animate** — Create a process from the tainted section of memory and initiate execution.
